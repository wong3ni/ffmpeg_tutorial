# DTS和PTS

## 简介

DTS(Decoding Time Stamp)和PTS(Presentation Time Stamp)中文分别称为**解码时间戳**和**显示时间戳**。在结构体`AVFrame`和`AVPacket`中都有它们的身影。DTS决定此帧什么时候解码(这里的帧并非是一副完整图像)，PTS决定此帧什么时候显示，如果它们的值设置不正确，就会导致视频显示不同步，播放有问题。这里涉及到一些压缩的基本概念，如I帧，P帧，B帧等待。

## I帧、P帧和B帧

为了节约视频的存储空间，压缩视频大小，会采用这三种特殊的帧的对图像进行压缩。

### I帧

I帧也叫关键帧，关键帧包含了一幅图像的完整信息，但是也是经过压缩过的，具体原理较为复杂，暂不考虑。虽然经过压缩，但是关键帧可以独立地还原成图像，不用依靠其它帧的信息。

### P帧

P帧也叫前向预测帧，它不能直接还原成图像。如果要还原成图像，需要依赖它前面的I帧或者B帧来生成完整的图像。

### B帧

B帧也叫双向预测帧，因为它想要还原成图像，需要依靠前面的I帧或P帧，还需要它后面的P帧。正是由于B帧的存在，DTS和PTS值有可能不一样。

### 举例说明

它们之间是如何通过彼此来还原图像的原理可以暂时不用考虑，只需要知道它们的作用即可。

下面举例说明B帧是如何影响DTS和PTS的。

假如有一组帧序列如下：

`I B B P B B P B B P B B P B P`

它的显示顺序当然是`1 2 3 4 5 6 7 8 9 10 11 12 13 14 15`

但是由于B帧的存在，它的解码顺序为：`1 3 4 2 6 7 5 9 10 8 12 13 11 15 14`

比如第2，3位的B帧，如果想要还原成图像，就必须把第4位的P帧先解码，然后才能解码2，3位的B帧，所以第4位的P帧解码应该为2，然后才是第2，3位的B帧。

可以使用命令`ffprobe -show_packets filename` 来查看packets信息

### GOP

两个I帧之间被称为一组GOP，比如`I B B P B B P B P I B ... `，这个序列的GOP为9。

## 参考文献

https://www.jianshu.com/p/cc58153ac98c

https://zhuanlan.zhihu.com/p/100029853